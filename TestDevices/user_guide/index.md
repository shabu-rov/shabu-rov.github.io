# Руководство пользователя TestDevices
**TestDevices** - приложение для тестирования аппаратной части Promobot Rooky и Promobot Robox и диагностирования соединения с ними. Позволяет определить наличие связи с каждым элементом из которых состоят Rooky и Robox. 
* Для Robox подвигать сервопривод и убедиться что датчик расстояния проводит измерения как УЗ сенсором, так и ИК сенсором.
* Для Rooky подвигать каждым сервоприводом каждого сустава, убедиться в работоспособности датчика касания.

ℹ️ Первостепенной целью TestDevices является проверка соединения и исправности оборудования, а не полноценное использование устройства. В связи с этим, оборудование имеет ограниченную функциональность по сравнению с остальным программным обеспечением, например связка [RRStudio + серверное ПО Rooky](/Rooky/rrs_control_ubuntu).

## Стартовый экран
Стартовый экран предлагает пользователю выбрать тип устройства, тестирование которого будет проводиться.

![](/TestDevices/user_guide/0.png)

## Экран выбора подключения
После выбора устройства на стартовом экране мы переходим на экран выбора последовательного порта ввода/вывода (COM порта - далее порт), к которому подключено устройство.

![](/TestDevices/user_guide/1.png)

> В данном руководстве примем во внимание, что все [драйвера](/Robox/res/drivers/CDM21228_Setup.exe) (Windows) или [правила](/Robox/setup_usb_rules) (Ubuntu) на интерфейсную плату установлены.

При использовании Windows доступные порты будут отображаться в формате **COM<..>**, где <..> - число от 0 до 255.

При использовании Ubuntu доступные порты будут отображаються в формате **/dev/ttyUSB<..>**, где <..> - число от 0 до 255.

![](/TestDevices/user_guide/2.png)

> Список доступных портов динамический, он обновляется один раз в несколько секунд. Если список пустой, ничего страшного, переподключите интерфейсную плату и устройство в списке появится.

Ссылка "Выбрать другое устройство" вернёт на стартовый экран.

Кнопка "Проверить" запустит процесс подключения к устройству.

## Экран подключения к устройству (Robox)

![](/TestDevices/user_guide/3.png)

Процесс подключения состоит из подключения к интерфейсной плате по указанному порту и последующего опроса элементов устройства:
* Датчика расстояния
* Сервопривода

Во время подключения можно наблюдать какой элемент в данный момент опрашивается.

![](/TestDevices/user_guide/4.png)

## Экран ошибки связи с интрефейсной платой
Данный экран возникает при ситуации, когда отсутсвует связь с интерфейсной платой, либо с ней пропала связь в процессе подключения.

![](/TestDevices/user_guide/5.png)

На экране ошибки связи досупны две кнопки:
* Кнопка повторного сканирования

  ![](/TestDevices/user_guide/6.png)

  Данная кнопка повторно запускает процесс подключения

* Кнопка дополнительных действий

  ![](/TestDevices/user_guide/7.png)

  Дополнительные действия следующие:
  * Выбрать другое устройство (вернет на стартовый экран)
  * Изменить способ подключения (вернет на экран выбора подключения)
  * Сканировать повторно (повторно запустит процесс подключения)

## Экран подключенного устройства (Robox)

![](/TestDevices/user_guide/8.png)

Экран состоит из нескольких элементов:
* Заголовок с типом протестированного устройства и статусом проведенного тестирования
* Таблица с элементами из которых состоит устройство
* Кнопка дополнительных действий

> Если связь с элементом отсутствует, либо элемент имеет ошибки со своей стороны не позволяющие работать, статуст связи горит красным. 
>
> Если элемент поддерживает возможность переподключения, присутсвует кнопка "Переподключить элемент".
>
> ![](/TestDevices/user_guide/9.png)
>
> Адрес - это адрес по которому можно обратиться к элементу по протоколу modbus.

Если связь с элементом установлена, можно нажать кнопку "Проверить". В этом случает откроется соответствующее элементу окно, позволяющее проверить исправность.

Например, для сервопривода окно проверки позволяет подвигать им.

![](/TestDevices/user_guide/10.png)

## Экран подключения к устройству (Rooky)
❗ Для корректной работы с устройством необходимо предварительно перед этапом подключения выставить Rooky в стартовое положение.

![](/TestDevices/user_guide/11.png)

Это позволит избежать ошибки "Некорректная позиция" (описание в следующей главе).

Процесс подключения к Rooky не отличается от подключения к Robox, за исключением дополнительного этапа определения типа Rooky (левая или правая) и отличных от Robox элементов.

![](/TestDevices/user_guide/12.png)

## Экран подключенного устройства (Rooky)

* Сервопривод надплечевого сустава
* Сервоприводы 1 и 2 плечевого сустава
* Сервоприводы 1 и 2 локтевого сустава
* Сервопривод кисти
* Сервопривод пальцев
* Датчик касания (расположен в обшивке ладони)

![](/TestDevices/user_guide/13.png)

> Ошибка "Некорректная позиция" означает что элемент (сервопривод) Rooky распололожен за доступном для движения пределом (например Rooky в вывернутом положении).
> 
> Пределы в тестовом приложении были установлены с целью уменьшить вероятность травмы, они меньше рабочих углов Rooky из [руководства пользователя](/Rooky/Promobot_Rooky_manual_screen_spreads.pdf)
>
> Для исправления ошибки достаточно руками повернуть элемент Rooky в стартовое положение.

TestDevices позволяет проверить работоспособность каждого сервопривода Rooky.

![](/TestDevices/user_guide/14.png)

> Ticks мера измерения разрешающей способности энкодера сервопривода.
>
> Например 16536 ticks на один оборот вала сервопривода.
>
> При использовании ticks стоит учитывать, что в элементах Rooky присутствует коэффициент редукции.

![](/TestDevices/user_guide/15.png)

> В кисти и пальцах используется другой тип сервоприводов. Этот тип принимает в качестве входных значений градусы.
>
> Но в этих элементах также присутствует коэффициент редукции. Поэтому повернуть сервопривод кисти на 10 градусов не равно повернуть кисть на 10 градусов.

![](/TestDevices/user_guide/16.png)

Датчик касания может реагировать как на касание обшивки ладони, так и на близкое поднесение руки (пальцев).

![](/TestDevices/user_guide/17.png)

> Нажатая кнопка экстренной остановки полностью обесточивает элементы Rooky.
>
> Связь со всеми элементами, кроме интерфейсной платы отсутствует.

![](/TestDevices/user_guide/18.png)

После "отжатия" кнопки экстренной остановки экран подключенного Rooky выглядит таким образом.

Статус: **"Ошибка. Необходимо переподключение"** означает что некоторые сервоприводы Rooky имеют ошибки, связь с ними есть, но, пока не сбросить ошибку, сервопривод двигаться не будет.

Проблему решить можно двумя способами:
* переподключить каждый элемент отдельно
* Нажать кнопку "Дополнительные действия" -> "Сканировать повторно"

![](/TestDevices/user_guide/19.png)

